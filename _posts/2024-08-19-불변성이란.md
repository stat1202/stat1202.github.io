---
categories: [프론트엔드, 리액트]
tags: [리액트, react, 자바스크립트, javascript, 불변성, immutability]
---

**"불변성을 유지해야한다."** 라는 말은 리액트를 공부하면서 가장 많이 듣는 말일 것이다. 실제로 많은 면접에서 물어보는 부분이기도 하다. 그렇다면 불변성이란 무엇이고, 왜 불변성을 유지해야할까?

# 불변성
불변성은 말 그대로의 의미이다.
> **불변성** <br>
> 변하지 않는 성질 <br>

이를 프로그래밍의 관점에서 본다면 상태를 변경할 수 없는 것이라고 말할 수 있을 것이다.

자바스크립트에서 불변성을 이해하기 위해서는 자바스크립트의 타입과 해당 타입의 값들이 어떻게 저장되는지에 대한 이해가 필요하다.

먼저, 자바스크립트는 콜 스택(Call Stack)과 메모리 힙(Heap Memory) 2종류의 메모리 공간을 가지고 있다.

> **콜 스택(Call Stack)<br>**
> 원시 타입 데이터가 저장된다.

> **메모리 힙(Heap Memory)<br>**
> 참조 타입 데이터가 저장된다.

우선은 이렇게 간단하게 알고 넘어가자.

위에서 타입에 대해 알아야 한다고 했다.<br>
그럼 원시 타입과 참조 타입이 무엇일까

> **원시 타입(Primitive Type)**<br>
> 하나의 값을 담는 타입으로 다음과 같은 타입들이 포함된다. `string`, `number`, `bigint`, `boolean`, `null`, `undefined`, `symbol`이 있다.


> **참조 타입(Reference Type)**<br>
> 값이 아닌 주소를 저장하는 타입으로 `Object`, `Array`, `function`이 대표적으로 참조 타입에 속한다.

![](/assets/img/post/2024-08-19/type.png)

위 그림은 원시 타입과 참조 타입 변수가 콜 스택과 메모리 힙에 어떻게 저장되는지 보여준다.

원시 타입은 콜 스택에 값이 그대로 저장된다.
반면 참조 타입 변수는 콜 스택의 값에는 `0010B`와 같은 메모리 주소가 저장되고 실제 값은 메모리 힙에 저장이 된다.

그렇다면 리액트에서 불변성은 어떤 의미를 가질까?

# 리액트에서의 불변성
"리액트에서 불변성을 지켜야한다."는 말의 의미는 메모리 힙 영역에서 값을 변경할 수 없어야한다는 의미이다. 그렇다면 왜 그래야할까?

리액트에서 자주 사용하는  `state`는 변화를 감지하고 이에 따라 `re-render` 해주는 역할을 한다.

하지만 이때 변화를 감지하는 **기준은 콜 스택의 주소값**을 **얕은 비교(shallow copy)** 로 비교한다. 즉, 이 말은 메모리 힙 영역이 변경되게 된다면 리액트에서는 변화를 감지하지 못한다는 의미다. 왜? 주소값은 변경되지 않았기 때문에.

우리가 리액트에서 `state`를 변경할 때 `[...prev, something]`과 같은 `spread` 연산자를 통해 `state`를 할당했다.

그 이유가 바로 깊은 복사로 새로운 주소 값을 할당해 콜 스택의 주소값을 변경해주기 위함인 것이다.

불변성이 어떤 것인지는 이해했다.
그렇다면 이렇게 불변성을 지키는 것이 어떤 이점이 있는 것일까?

# 불변성의 이점
### 사이드 이펙트 방지
원본 데이터를 수정하지 않고, 복사본을 만들어 변경함으로써 예상치 못한 오류를 사전에 방지할 수 있다.

### 성능상의 이점
리액트에서 만약 깊은 비교를 수행한다면 객체의 값을 하나하나 모두 비교해 상태가 변경되었는지 파악해야할 것이다. 이는 엄청나게 비효율적인 작업이 될 것이다. 그래서 리액트는 얕은 비교를 통해 빠르게 주소값이 변경되었는지만 파악하고, 이를 `re-render` 해준다.


> **출처** <br>
https://lasbe.tistory.com/143
https://velog.io/@rudans987/%EB%B6%88%EB%B3%80%EC%84%B1%EC%9D%B4%EB%9E%80
